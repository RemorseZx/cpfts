-- Services
local Players        = game:GetService("Players")
local RunService     = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace      = game:GetService("Workspace")

local LocalPlayer    = Players.LocalPlayer
local Camera         = Workspace.CurrentCamera

-- SETTINGS ---------------------------------------------------------
local FOV_RADIUS     = 85          -- Adjust as you like
local SNAP_SPEED     = 0.15        -- 0 = instant, 0.1-0.3 = smooth
local SHOW_FOV       = true        -- Set false kung ayaw mo makita yung circle
-- ------------------------------------------------------------------

-- Optional FOV circle (Drawing API works on mobile)
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 2
fovCircle.NumSides  = 64
fovCircle.Filled    = false
fovCircle.Transparency = 0.8
fovCircle.Color     = Color3.fromRGB(255,0,0)
fovCircle.Visible   = SHOW_FOV
fovCircle.Radius    = FOV_RADIUS

-- Get closest alive enemy head inside FOV (centered sa gitna ng screen)
local function getClosestTarget()
    local screenCenter = Camera.ViewportSize * 0.5
    local closestDist = math.huge
    local targetHead  = nil

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local head = plr.Character:FindFirstChild("Head")
            local hum  = plr.Character:FindFirstChildOfClass("Humanoid")
            if head and hum and hum.Health > 0 then
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local dist = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                    if dist < closestDist and dist <= FOV_RADIUS then
                        closestDist = dist
                        targetHead  = head
                    end
                end
            end
        end
    end
    return targetHead
end

-- Move camera toward world position (mobile-friendly)
local function lookAtWorldPosition(worldPos)
    local camCFrame = Camera.CFrame
    local targetCFrame = CFrame.new(camCFrame.Position, worldPos)

    -- Lerp for smoothness (SNAP_SPEED = 0 â†’ instant)
    Camera.CFrame = camCFrame:lerp(targetCFrame, SNAP_SPEED)
end

-- Main loop - NAKA-ON NA AGAD pag inexecute! -----------------------
RunService.RenderStepped:Connect(function()
    -- FOV circle sa gitna ng screen palagi
    fovCircle.Position = Camera.ViewportSize * 0.5

    -- Laging naghahanap ng pinakamalapit na target
    local targetHead = getClosestTarget()
    if targetHead then
        lookAtWorldPosition(targetHead.Position)
    end
end)
